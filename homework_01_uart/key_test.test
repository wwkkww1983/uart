<!DOCTYPE Robei>
<Module File="Current/key_test.test" Name="key_test" Include="" Class="module" Code="//&#xa;// Generate clk&#xa;//&#xa;initial begin &#xa;  clk = 0;&#xa;end&#xa;always #3250 clk = ~clk;&#xa;&#xa;//&#xa;// Generate reset signal&#xa;//&#xa;initial begin&#xa;  rst_n = 1;&#xa;  repeat(1) @( posedge clk ) #1;&#xa;  rst_n = 0;&#xa;  repeat(1) @( posedge clk ) #1;&#xa;  rst_n = 1;  &#xa;end&#xa;&#xa;// &#xa;// Generate key signal&#xa;//&#xa;initial begin&#xa;  key_in = 4'b1111;&#xa;  repeat(3077) @( posedge clk ) #1;&#xa;  key_in = 4'b1110;&#xa;  repeat(3077) @( posedge clk ) #1;&#xa;  key_in = 4'b1101;&#xa;  repeat(3077) @( posedge clk ) #1;&#xa;  key_in = 4'b1011;&#xa;  repeat(3077) @( posedge clk ) #1;&#xa;  key_in = 4'b0111;&#xa;  repeat(3077) @( posedge clk ) #1;     &#xa;  #10 $finish;&#xa;end" Comment="" Type="testbench" Width="900" Height="600" Time_Scale="" X="0" Color="#d3d3d3" Y="0" Parent="0">
 <Module File="Current/key.model" Name="key1" Parameters="" Include="" Class="key" Code="`define DEL 1&#xa;&#xa;//&#xa;// Key signal detected&#xa;//&#xa;reg    [3:0] key_in_q;&#xa;wire   [3:0] key_flag;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    key_in_q &lt;= #`DEL 4'b0;&#xa;  end&#xa;  else begin&#xa;    key_in_q &lt;= #`DEL key_in;&#xa;  end&#xa;end      &#xa;assign key_flag = key_in_q &amp;&amp; ( ~key_in );&#xa;&#xa;//&#xa;// Delay 20ms&#xa;//&#xa;reg   [19:0] cnt;&#xa;reg   [ 3:0] key_flag_delay;  // Detect key's status after delay 20ms&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    cnt            &lt;= #`DEL 20'd0;&#xa;    key_flag_delay &lt;= #`DEL  4'd0;&#xa;  end&#xa;  else if( cnt == 20'd 999_999 ) begin&#xa;    cnt            &lt;= #`DEL 20'd0;&#xa;    key_flag_delay &lt;= #`DEL key_flag;&#xa;  end // 20ms&#xa;  else begin&#xa;    cnt            &lt;= #`DEL cnt + 20'd1;&#xa;    key_flag_delay &lt;= #`DEL 4'd0;&#xa;  end&#xa;end&#xa;&#xa;//&#xa;// If key has been pressed, output&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    key_out     &lt;= #`DEL 8'd0;&#xa;    key_pressed &lt;= #`DEL 1'd0;&#xa;  end&#xa;  else begin&#xa;    case( key_flag_delay ) &#xa;      4'b0000: begin&#xa;        key_out     &lt;= #`DEL 8'd0;&#xa;        key_pressed &lt;= #`DEL 1'd0;&#xa;      end // Reset key&#xa;      4'b0001: begin&#xa;        key_out     &lt;= #`DEL 8'd1;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The first key's value is 1&#xa;      4'b0010: begin&#xa;        key_out     &lt;= #`DEL 8'd2;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The second key's value is 2&#xa;      4'b0100: begin&#xa;        key_out     &lt;= #`DEL 8'd3;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The third key's value is 3&#xa;      default: begin&#xa;        key_out     &lt;= #`DEL 8'd0;&#xa;        key_pressed &lt;= #`DEL 1'd0;&#xa;      end &#xa;    endcase&#xa;  end&#xa;end      &#xa;" Comment="" Type="model" Width="278" Height="258" X="387.948" Color="#d3d3d3" Y="204.117" Parent="key_test">
  <Port Side="left" Name="clk" Datatype="wire" Datasize="1" Width="20" Height="20" Connect="" X="-0.0719424" Inout="input" Function="" Color="#0000ff" Y="0.158915" Parent="key1"/>
  <Port Side="left" Name="rst_n" Datatype="wire" Datasize="1" Width="20" Height="20" Connect="" X="-0.0719424" Inout="input" Function="" Color="#00ffff" Y="0.356589" Parent="key1"/>
  <Port Side="left" Name="key_in" Datatype="wire" Datasize="4" Width="20" Height="20" Connect="" X="-0.0719424" Inout="input" Function="" Color="#8a2be2" Y="0.554264" Parent="key1"/>
  <Port Side="right" Name="key_out" Datatype="wire" Datasize="9" Width="20" Height="20" Connect="" X="0.928058" Inout="output" Function="" Color="#a52a2a" Y="0.209302" Parent="key1"/>
  <Port Side="right" Name="key_pressed" Datatype="reg" Datasize="1" Width="20" Height="20" Connect="" X="0.928058" Inout="output" Function="" Color="#ff7f50" Y="0.457364" Parent="key1"/>
 </Module>
 <Port Side="left" Name="clk" Datatype="reg" Datasize="1" Width="20" Height="20" X="-0.0222222" Inout="input" Function="" Color="#0000ff" Y="0.183333" Parent="key_test"/>
 <Port Side="left" Name="rst_n" Datatype="reg" Datasize="1" Width="20" Height="20" X="-0.0222222" Inout="input" Function="" Color="#00ffff" Y="0.383333" Parent="key_test"/>
 <Port Side="left" Name="key_in" Datatype="reg" Datasize="4" Width="20" Height="20" X="-0.0222222" Inout="input" Function="" Color="#8a2be2" Y="0.583333" Parent="key_test"/>
 <Port Side="right" Name="key_out" Datatype="wire" Datasize="9" Width="20" Height="20" X="0.977778" Inout="output" Function="" Color="#a52a2a" Y="0.233333" Parent="key_test"/>
 <Port Side="right" Name="key_pressed" Datatype="wire" Datasize="1" Width="20" Height="20" X="0.977778" Inout="output" Function="" Color="#ff7f50" Y="0.483333" Parent="key_test"/>
 <Wire Name="key_test_clk" Datatype="wire" Datasize="1" From="key_test>clk" To="key_test#key1>clk" Parent="key_test"/>
 <Wire Name="key_test_rst_n" Datatype="wire" Datasize="1" From="key_test>rst_n" To="key_test#key1>rst_n" Parent="key_test"/>
 <Wire Name="key_test_key_in" Datatype="wire" Datasize="4" From="key_test>key_in" To="key_test#key1>key_in" Parent="key_test"/>
 <Wire Name="key1_key_out" Datatype="wire" Datasize="9" From="key_test#key1>key_out" To="key_test>key_out" Parent="key_test"/>
 <Wire Name="key1_key_pressed" Datatype="wire" Datasize="1" From="key_test#key1>key_pressed" To="key_test>key_pressed" Parent="key_test"/>
</Module>
