<!DOCTYPE Robei>
<Module Code="`define DEL 1&#xa;&#xa;wire [7:0] key_out;&#xa;wire [7:0] count_out;&#xa;wire       key_pressed;&#xa;wire       count_full;&#xa;&#xa;reg  [7:0] data_send;&#xa;reg        tx_en;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    data_send &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else if( key_pressed ) begin&#xa;    data_send &lt;= #`DEL key_out;&#xa;  end&#xa;  else if( count_full ) begin&#xa;    data_send &lt;= #`DEL count_out;&#xa;  end&#xa;end   &#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    tx_en     &lt;= #`DEL 1'd0;&#xa;  end&#xa;  else begin&#xa;    tx_en     &lt;= #`DEL key_pressed || count_full;&#xa;  end&#xa;end    &#xa;" X="68.8647" Name="uart_top" Class="module" Parameters="" Width="1293" Include="" Parent="0" Comment="" Color="#d3d3d3" Height="724" Y="171.299" File="Current/uart_top.model" Type="module">
 <Module Code="`define DEL 1&#xa;&#xa;//&#xa;// Key signal detected&#xa;//&#xa;reg    [3:0] key_in_q;&#xa;wire   [3:0] key_flag;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    key_in_q &lt;= #`DEL 4'b0;&#xa;  end&#xa;  else begin&#xa;    key_in_q &lt;= #`DEL key_in;&#xa;  end&#xa;end      &#xa;assign key_flag = key_in_q &amp; ( ~key_in );&#xa;&#xa;//&#xa;// Delay 20ms&#xa;//&#xa;reg   [19:0] cnt;&#xa;reg   [ 3:0] key_flag_delay;  // Detect key's status after delay 20ms&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    cnt            &lt;= #`DEL 20'd0;&#xa;    key_flag_delay &lt;= #`DEL  4'd0;&#xa;  end&#xa;  else if( cnt == 20'd 999_998 ) begin&#xa;    cnt            &lt;= #`DEL cnt + 20'd1;&#xa;    key_flag_delay &lt;= #`DEL key_flag;&#xa;  end // 20ms&#xa;  else if( cnt == 20'd 999_999 ) begin&#xa;    cnt            &lt;= #`DEL 20'd0;&#xa;    key_flag_delay &lt;= #`DEL 4'd0;&#xa;  end // 20ms&#xa;  else begin&#xa;    cnt            &lt;= #`DEL cnt + 20'd1;&#xa;    key_flag_delay &lt;= #`DEL 4'd0;&#xa;  end&#xa;end&#xa;&#xa;//&#xa;// If key has been pressed, output&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    key_out     &lt;= #`DEL 8'd0;&#xa;    key_pressed &lt;= #`DEL 1'd0;&#xa;  end&#xa;  else begin&#xa;    case( key_flag_delay ) &#xa;      4'b0000: begin&#xa;        key_out     &lt;= #`DEL 8'd0;&#xa;        key_pressed &lt;= #`DEL 1'd0;&#xa;      end // No key pressed&#xa;      4'b0001: begin&#xa;        key_out     &lt;= #`DEL 8'd1;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The first key's value is 1&#xa;      4'b0010: begin&#xa;        key_out     &lt;= #`DEL 8'd2;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The second key's value is 2&#xa;      4'b0100: begin&#xa;        key_out     &lt;= #`DEL 8'd3;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The third key's value is 3&#xa;      4'b1000: begin&#xa;        key_out     &lt;= #`DEL 8'd4;&#xa;        key_pressed &lt;= #`DEL 1'd1;&#xa;      end // The third key's value is 4&#xa;      default: begin&#xa;        key_out     &lt;= #`DEL key_out;&#xa;        key_pressed &lt;= #`DEL 1'd0;&#xa;      end &#xa;    endcase&#xa;  end&#xa;end      &#xa;" X="223.933" Name="key1" Class="key" Parameters="" Width="160" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="160" Y="177.191" File="Current/key.model" Type="model">
  <Port Datasize="1" Function="" X="-0.125" Name="clk" Inout="input" Width="20" Connect="" Parent="key1" Color="#0000ff" Height="20" Y="0.1375" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="rst_n" Inout="input" Width="20" Connect="" Parent="key1" Color="#00ffff" Height="20" Y="0.3375" Side="left" Datatype="wire"/>
  <Port Datasize="4" Function="" X="-0.125" Name="key_in" Inout="input" Width="20" Connect="" Parent="key1" Color="#8a2be2" Height="20" Y="0.5375" Side="left" Datatype="wire"/>
  <Port Datasize="9" Function="" X="0.875" Name="key_out" Inout="output" Width="20" Connect="key_out" Parent="key1" Color="#a52a2a" Height="20" Y="0.1875" Side="right" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.875" Name="key_pressed" Inout="output" Width="20" Connect="key_pressed" Parent="key1" Color="#ff7f50" Height="20" Y="0.4375" Side="right" Datatype="reg"/>
 </Module>
 <Module Code="`define DEL 1&#xa;&#xa;//&#xa;// There should be two datas to control frequency division and duty seperately&#xa;// The first data is to control the division, while the second control the duty&#xa;//&#xa;reg [7:0] division;&#xa;reg [7:0] duty_num;&#xa;&#xa;//&#xa;// Detect the rising edge of data_en&#xa;reg     data_en_q;&#xa;wire    data_en_flag;&#xa;reg     cnt_div_duty;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    data_en_q &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    data_en_q &lt;= #`DEL data_en;&#xa;  end&#xa;end&#xa;assign data_en_flag = ( data_en_q ) &amp;&amp; ( ~data_en );&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    division     &lt;= #`DEL 8'd0;&#xa;    duty_num     &lt;= #`DEL 8'd0;&#xa;    cnt_div_duty &lt;= #`DEL 1'd1;&#xa;  end&#xa;  else if( data_en_flag ) begin&#xa;    case( cnt_div_duty )&#xa;      1:begin&#xa;        division     &lt;= #`DEL data_in[7:0];&#xa;        duty_num     &lt;= #`DEL duty_num;&#xa;        cnt_div_duty &lt;= #`DEL cnt_div_duty + 1'b1;&#xa;      end&#xa;      0:begin&#xa;        division     &lt;= #`DEL division;&#xa;        duty_num     &lt;= #`DEL data_in[7:0];&#xa;        cnt_div_duty &lt;= #`DEL cnt_div_duty + 1'b1;&#xa;      end&#xa;    endcase&#xa;  end&#xa;end &#xa;&#xa;//&#xa;// Parity check&#xa;//&#xa;always @( posedge clk ) begin&#xa;  if( data_in[8] != ^data_in[7:0] ) begin&#xa;    $display(&quot;Uart communication error!&quot;);&#xa;    $stop;&#xa;  end&#xa;end      &#xa;&#xa;&#xa;//&#xa;// Even division, which duty is 50%&#xa;//&#xa;reg           clk_even;&#xa;wire          clk_out_div;&#xa;reg     [7:0] cnt_even;&#xa;wire    [7:0] division_even;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    cnt_even &lt;= #`DEL 8'd0;&#xa;    clk_even &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( division[0]==1 || ~cnt_div_duty ) begin&#xa;    cnt_even &lt;= #`DEL 8'd0;&#xa;    clk_even &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    if( division[7:0] == 8'd0 ) begin    &#xa;      cnt_even &lt;= #`DEL 8'd0;&#xa;    end&#xa;    else if( cnt_even == ( division_even - 1 ) ) begin&#xa;      cnt_even &lt;= #`DEL 8'd0;&#xa;      clk_even &lt;= #`DEL ~clk_even;&#xa;    end&#xa;    else begin&#xa;      cnt_even &lt;= #`DEL cnt_even + 8'd1;&#xa;      clk_even &lt;= #`DEL clk_even;&#xa;    end&#xa;  end&#xa;end     &#xa;&#xa;assign division_even = ( division[0] == 0 ) ? ( division[7:0] >> 1 ) : 0;&#xa;&#xa;//&#xa;// Odd division, which duty is 50%&#xa;//&#xa;reg         clk_p;&#xa;reg         clk_n;&#xa;wire        clk_odd;&#xa;reg   [7:0] cnt_p;&#xa;reg   [7:0] cnt_n;&#xa;wire  [7:0] division_odd;&#xa;&#xa;//&#xa;// Rising edge&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    clk_p &lt;= #`DEL 1'b0;&#xa;    cnt_p &lt;= #`DEL 8'b0;&#xa;  end&#xa;  else if( division[0]==0 || ~cnt_div_duty ) begin    &#xa;    clk_p &lt;= #`DEL 1'b0;&#xa;    cnt_p &lt;= #`DEL 8'b0;&#xa;  end&#xa;  else begin&#xa;    if( cnt_p == division_odd - 1 ) begin&#xa;      clk_p &lt;= #`DEL ~clk_p;&#xa;      cnt_p &lt;= #`DEL 8'b0;&#xa;    end&#xa;    else if( cnt_p == ( ( division[7:0] - 1 ) >> 1 ) )begin&#xa;      clk_p &lt;= #`DEL ~clk_p;&#xa;      cnt_p &lt;= #`DEL cnt_p + 8'b1;&#xa;    end&#xa;    else begin&#xa;      clk_p &lt;= #`DEL clk_p;&#xa;      cnt_p &lt;= #`DEL cnt_p + 8'b1;&#xa;    end&#xa;  end&#xa;end      &#xa;&#xa;//&#xa;// Falling edge&#xa;always @( negedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    clk_n &lt;= #`DEL 1'b0;&#xa;    cnt_n &lt;= #`DEL 8'b0;&#xa;  end&#xa;  else if( division[0]==0 || ~cnt_div_duty ) begin    &#xa;    clk_n &lt;= #`DEL 1'b0;&#xa;    cnt_n &lt;= #`DEL 8'b0;&#xa;  end&#xa;  else begin&#xa;    if( cnt_n == division_odd - 1 ) begin&#xa;      clk_n &lt;= #`DEL ~clk_n;&#xa;      cnt_n &lt;= #`DEL 8'b0;&#xa;    end&#xa;    else if( cnt_n == ( ( division[7:0] - 1 ) >> 1 ) )begin&#xa;      clk_n &lt;= #`DEL ~clk_n;&#xa;      cnt_n &lt;= #`DEL cnt_n + 8'b1;&#xa;    end&#xa;    else begin&#xa;      clk_n &lt;= #`DEL clk_n;&#xa;      cnt_n &lt;= #`DEL cnt_n + 8'b1;&#xa;    end&#xa;  end&#xa;end     &#xa;&#xa;&#xa;assign division_odd = ( division[0] == 1 ) ? division[7:0] : 0;&#xa;assign clk_odd = clk_n | clk_p;&#xa;&#xa;assign clk_out_div = ( division[0] == 1 ) ? clk_odd : clk_even;&#xa;&#xa;//&#xa;// Duty&#xa;//&#xa;reg [7:0] cnt_duty; // Used in duty generate&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    cnt_duty &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else if( ( duty_num == (division[7:0]>>1) ) || cnt_duty_flag || ~cnt_div_duty ) begin&#xa;    // If duty is half of division[7:0] that means duty is 50%,&#xa;    // use clk_div as clk_out&#xa;    // If cnt_duty_flag is 1, then count begin from 0&#xa;    cnt_duty &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else if( cnt_duty == division[7:0] )begin&#xa;    cnt_duty &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else begin&#xa;    cnt_duty &lt;= #`DEL cnt_duty + 8'd1;&#xa;  end&#xa;end      &#xa;&#xa;//&#xa;// Attention: duty_num is an input signal, which is equal to duty(%) * division&#xa;reg clk_out_duty;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    clk_out_duty &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( duty_num == (division[7:0]>>1) || cnt_duty_flag || ~cnt_div_duty ) begin&#xa;    clk_out_duty &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( cnt_duty &lt; duty_num )begin&#xa;    clk_out_duty &lt;= #`DEL 1'b1;&#xa;  end&#xa;  else begin&#xa;    clk_out_duty &lt;= #`DEL 1'b0;&#xa;  end&#xa;end      &#xa;&#xa;// While duty_num is half of division which means duty is 50%, clk_out is generated by the first method that is more accurate than the second method&#xa;// While duty is not 50%,clk_out is generated by the 2nd way which duty is variable&#xa;assign clk_out = ( duty_num == (division[7:0]>>1) || duty_num == 0 ) ? clk_out_div : clk_out_duty;&#xa;&#xa;//&#xa;// Detect the change of duty_num and division&#xa;//&#xa;reg [7:0]  duty_num_temp;&#xa;reg [7:0]  division_temp;&#xa;reg        duty_num_flag;&#xa;reg        division_flag;&#xa;reg        cnt_duty_flag;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    duty_num_temp &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else begin&#xa;    duty_num_temp &lt;= #`DEL duty_num;&#xa;  end&#xa;end      &#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    division_temp &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else begin&#xa;    division_temp &lt;= #`DEL division;&#xa;  end&#xa;end &#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    duty_num_flag &lt;= #`DEL 1'd0;&#xa;    division_flag &lt;= #`DEL 1'd0;&#xa;  end&#xa;  else if( duty_num_temp != duty_num )begin&#xa;    duty_num_flag &lt;= #`DEL 1'd1;&#xa;  end&#xa;  else if( division_temp != division )begin&#xa;    division_flag &lt;= #`DEL 1'd1;&#xa;  end&#xa;  else begin &#xa;    duty_num_flag &lt;= #`DEL 1'd0;&#xa;    division_flag &lt;= #`DEL 1'd0;&#xa;  end&#xa;end      &#xa;&#xa;//&#xa;// Generate the start counting signal of cnt_duty. If cnt_duty_flag is 1, which means division or duty_num has changed, then cnt_duty start count from 0 again&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    cnt_duty_flag &lt;= #`DEL 1'd0;&#xa;  end&#xa;  else if( duty_num_flag || division_flag )begin&#xa;    cnt_duty_flag &lt;= #`DEL 1'd1;&#xa;  end&#xa;  else begin&#xa;    cnt_duty_flag &lt;= #`DEL 1'd0;&#xa;  end&#xa;end &#xa;&#xa;" X="957.343" Name="division_duty1" Class="division_duty" Parameters="" Width="160" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="160" Y="152.848" File="Current/division_duty.model" Type="model">
  <Port Datasize="1" Function="" X="-0.125" Name="clk" Inout="input" Width="20" Connect="" Parent="division_duty1" Color="#0000ff" Height="20" Y="0.2125" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="rst_n" Inout="input" Width="20" Connect="" Parent="division_duty1" Color="#00ffff" Height="20" Y="0.35" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.875" Name="clk_out" Inout="output" Width="20" Connect="" Parent="division_duty1" Color="#a52a2a" Height="20" Y="0.26875" Side="right" Datatype="wire"/>
  <Port Datasize="9" Function="" X="-0.125" Name="data_in" Inout="input" Width="20" Connect="" Parent="division_duty1" Color="#7fff00" Height="20" Y="0.625" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="data_en" Inout="input" Width="20" Connect="" Parent="division_duty1" Color="#ff1493" Height="20" Y="0.4875" Side="left" Datatype="wire"/>
  <Port Datasize="8" Function="" X="-0.125" Name="division_num" Inout="output" Width="20" Connect="" Parent="division_duty1" Color="#00bfff" Height="20" Y="0.075" Side="left" Datatype="wire"/>
 </Module>
 <Module Code="`define DEL 1&#xa;&#xa;//&#xa;// This block is used to receive data&#xa;//&#xa;reg         rx_q;&#xa;wire        rx_start;&#xa;reg  [7:0]  rx_cnt;&#xa;reg         rx_cnt_en;&#xa;&#xa;// &#xa;// Edge deteted&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    rx_q &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    rx_q &lt;= #`DEL rx;&#xa;  end&#xa;end      &#xa;// Falling edge effective&#xa;assign rx_start = ( rx_q &amp;&amp; ~rx );&#xa;&#xa;//&#xa;// Generate the count enable signal &#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    rx_cnt_en &lt;= #`DEL 1'b0;&#xa;  end&#xa;  //&#xa;  // Count enable&#xa;  else if( rx_start ) begin&#xa;    rx_cnt_en &lt;= #`DEL 1'b1;&#xa;  end&#xa;  //&#xa;  // Count disable&#xa;  else if( rx_cnt == 8'd168 ) begin&#xa;    rx_cnt_en &lt;= #`DEL 1'b0;&#xa;  end&#xa;end     &#xa;&#xa;//&#xa;// Frequence division&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if ( ~rst_n ) begin&#xa;    rx_cnt &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else if ( rx_cnt_en ) begin&#xa;    rx_cnt &lt;= #`DEL rx_cnt + 8'b1;&#xa;  end&#xa;  else begin&#xa;    rx_cnt &lt;= #`DEL 8'b0;&#xa;  end&#xa;end&#xa;&#xa;//&#xa;// FSM&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    data_received &lt;= #`DEL 9'b0;&#xa;    rx_buf_full   &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( rx_cnt_en ) begin&#xa;    case( rx_cnt ) &#xa;      8'd24: begin&#xa;        data_received[0] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end  // Least significant bit&#xa;      8'd40: begin&#xa;        data_received[1] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd56: begin&#xa;        data_received[2] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd72: begin&#xa;        data_received[3] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd88: begin&#xa;        data_received[4] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd104: begin&#xa;        data_received[5] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd120: begin&#xa;        data_received[6] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end&#xa;      8'd136: begin&#xa;        data_received[7] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end  // Most significant bit&#xa;      8'd152: begin&#xa;        data_received[8] &lt;= #`DEL rx;&#xa;        rx_buf_full      &lt;= #`DEL 1'b0;&#xa;      end  // Parity check&#xa;      8'd168: begin&#xa;        rx_buf_full      &lt;= #`DEL 1'b1;&#xa;      end  // Stop bit&#xa;    endcase&#xa;  end// Least significant bit&#xa;end      &#xa;&#xa;//&#xa;// This block is used to transmit data&#xa;//&#xa;reg         tx_en_q;&#xa;wire        tx_start;&#xa;reg  [7:0]  tx_cnt;&#xa;reg         tx_cnt_en;&#xa;reg  [8:0]  shift_reg;&#xa;&#xa;// &#xa;// Edge deteted&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    tx_en_q &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    tx_en_q &lt;= #`DEL tx_en;&#xa;  end&#xa;end      &#xa;// Rising edge effective&#xa;assign tx_start = ( ~tx_en_q &amp;&amp; tx_en );&#xa;&#xa;//&#xa;// Transmit data_send to shift_reg&#xa;//&#xa;always @( posedge tx_start or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    shift_reg &lt;= #`DEL 9'd0;&#xa;  end&#xa;  else begin&#xa;    shift_reg[7:0] &lt;= #`DEL data_send;&#xa;    //&#xa;    // Parity check bit, even parity&#xa;    shift_reg[8]   &lt;= #`DEL ( ^data_send ) ? 1 : 0;   &#xa;  end&#xa;end      &#xa;&#xa;//&#xa;// Generate the count enable signal &#xa;// Generate the tx_buf_full signal which means shift_reg is not empty&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    tx_cnt_en   &lt;= #`DEL 1'b0;&#xa;    tx_buf_full &lt;= #`DEL 1'b0;&#xa;  end&#xa;  //&#xa;  // Count enable&#xa;  else if( tx_start ) begin&#xa;    tx_cnt_en   &lt;= #`DEL 1'b1;&#xa;    tx_buf_full &lt;= #`DEL 1'b1;&#xa;  end&#xa;  //&#xa;  // Count disable&#xa;  else if( tx_cnt == 8'd176 ) begin&#xa;    tx_cnt_en   &lt;= #`DEL 1'b0;&#xa;    tx_buf_full &lt;= #`DEL 1'b0;&#xa;  end&#xa;end     &#xa;&#xa;//&#xa;// Frequence division&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if ( ~rst_n ) begin&#xa;    tx_cnt &lt;= #`DEL 8'd0;&#xa;  end&#xa;  else if ( tx_cnt_en ) begin&#xa;    tx_cnt &lt;= #`DEL tx_cnt + 8'b1;&#xa;  end&#xa;  else begin&#xa;    tx_cnt &lt;= #`DEL 8'b0;&#xa;  end&#xa;end&#xa;&#xa;//&#xa;// FSM&#xa;//&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    tx &lt;= #`DEL 1'b1;&#xa;  end&#xa;  else if( tx_cnt_en ) begin&#xa;    case( tx_cnt ) &#xa;      8'd0: begin&#xa;        tx &lt;= #`DEL 1'b0;&#xa;      end  // Start signal&#xa;      8'd16: begin&#xa;        tx &lt;= #`DEL shift_reg[0];&#xa;      end  // Least significant bit&#xa;      8'd32: begin&#xa;        tx &lt;= #`DEL shift_reg[1];&#xa;      end&#xa;      8'd48: begin&#xa;        tx &lt;= #`DEL shift_reg[2];&#xa;      end&#xa;      8'd64: begin&#xa;        tx &lt;= #`DEL shift_reg[3];&#xa;      end&#xa;      8'd80: begin&#xa;        tx &lt;= #`DEL shift_reg[4];&#xa;      end&#xa;      8'd96: begin&#xa;        tx &lt;= #`DEL shift_reg[5];&#xa;      end&#xa;      8'd112: begin&#xa;        tx &lt;= #`DEL shift_reg[6];&#xa;      end  &#xa;      8'd128: begin&#xa;        tx &lt;= #`DEL shift_reg[7];&#xa;      end  // Most significant bit&#xa;      8'd144: begin&#xa;        tx &lt;= #`DEL shift_reg[8];&#xa;      end  // Parity check      &#xa;      8'd160: begin&#xa;        tx &lt;= #`DEL 1'b1;&#xa;      end  // Stop bit&#xa;    endcase&#xa;  end&#xa;end      &#xa;" X="500.566" Name="uart1" Class="uart" Parameters="" Width="254" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="242" Y="279.469" File="Current/uart.model" Type="model">
  <Port Datasize="1" Function="" X="-0.0787402" Name="clk" Inout="input" Width="20" Connect="" Parent="uart1" Color="#00ffff" Height="20" Y="0.0991736" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.0787402" Name="rst_n" Inout="input" Width="20" Connect="" Parent="uart1" Color="#7fffd4" Height="20" Y="0.239669" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.0787402" Name="rx" Inout="input" Width="20" Connect="" Parent="uart1" Color="#0000ff" Height="20" Y="0.380165" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.0787402" Name="tx_en" Inout="input" Width="20" Connect="tx_en" Parent="uart1" Color="#8a2be2" Height="20" Y="0.520661" Side="left" Datatype="wire"/>
  <Port Datasize="8" Function="" X="-0.0787402" Name="data_send" Inout="input" Width="20" Connect="data_send" Parent="uart1" Color="#a52a2a" Height="20" Y="0.661157" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.92126" Name="tx_buf_full" Inout="output" Width="20" Connect="" Parent="uart1" Color="#5f9ea0" Height="20" Y="0.123967" Side="right" Datatype="reg"/>
  <Port Datasize="1" Function="" X="0.92126" Name="rx_buf_full" Inout="output" Width="20" Connect="" Parent="uart1" Color="#b8860b" Height="20" Y="0.289256" Side="right" Datatype="reg"/>
  <Port Datasize="1" Function="" X="0.92126" Name="tx" Inout="output" Width="20" Connect="" Parent="uart1" Color="#7fff00" Height="20" Y="0.454545" Side="right" Datatype="reg"/>
  <Port Datasize="9" Function="" X="0.92126" Name="data_received" Inout="output" Width="20" Connect="" Parent="uart1" Color="#ff8c00" Height="20" Y="0.619835" Side="right" Datatype="reg"/>
 </Module>
 <Module Code="`define DEL 1&#xa;&#xa;//&#xa;// Count enable edge detected&#xa;//&#xa;reg     count_en_q;&#xa;reg     count_en_start;&#xa;wire    count_en_flag;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    count_en_q &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    count_en_q &lt;= #`DEL count_en;&#xa;  end&#xa;end&#xa;assign count_en_flag = ~count_en_q &amp;&amp; ( count_en );&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    count_en_start &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( count_en_flag )begin&#xa;    count_en_start &lt;= #`DEL 1'b1;&#xa;  end&#xa;  else if( count == 8'd99 ) begin&#xa;    count_en_start &lt;= #`DEL 1'b0;&#xa;  end&#xa;end      &#xa;&#xa;&#xa;//&#xa;// Tx_done edge detected&#xa;// Tx_done signal comes from uart unit, while uart transmit one data done, begining next count &#xa;//&#xa;reg     tx_done_q;&#xa;wire    tx_done_n;&#xa;wire    tx_done_flag;&#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    tx_done_q &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else begin&#xa;    tx_done_q &lt;= #`DEL tx_done_n;&#xa;  end&#xa;end&#xa;assign tx_done_n = ~tx_done;&#xa;assign tx_done_flag = ~tx_done_q &amp;&amp; ( tx_done_n );&#xa;&#xa;//&#xa;// Countdown and output&#xa;//&#xa;reg [7:0] count;&#xa;   &#xa;&#xa;always @( posedge clk or negedge rst_n ) begin&#xa;  if( ~rst_n ) begin&#xa;    count      &lt;= #`DEL 8'd0;&#xa;    count_full &lt;= #`DEL 1'b0;&#xa;  end&#xa;  else if( count_en_flag ) begin&#xa;    count &lt;= #`DEL 1'b0;&#xa;    count_full &lt;= #`DEL 1'b1;&#xa;  end&#xa;  else if( count_en_start ) begin&#xa;    if( tx_done_flag ) begin&#xa;      if( count == 8'd99 )begin&#xa;        count      &lt;= #`DEL 8'd0;&#xa;        count_full &lt;= #`DEL 1'b0;&#xa;      end&#xa;      else begin&#xa;        count      &lt;= #`DEL count + 1;&#xa;        count_full &lt;= #`DEL 1'b1;&#xa;      end&#xa;    end     &#xa;    else begin&#xa;      count      &lt;= #`DEL count;&#xa;      count_full &lt;= #`DEL 1'b0;&#xa;    end&#xa;  end  &#xa;  else begin&#xa;    count      &lt;= #`DEL count;&#xa;    count_full &lt;= #`DEL 1'b0;&#xa;  end&#xa;end&#xa;&#xa;assign count_out  =  count;" X="227.343" Name="countdown1" Class="countdown" Parameters="" Width="160" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="160" Y="410.189" File="Current/countdown.model" Type="model">
  <Port Datasize="1" Function="" X="-0.125" Name="clk" Inout="input" Width="20" Connect="" Parent="countdown1" Color="#0000ff" Height="20" Y="0.1375" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="rst_n" Inout="input" Width="20" Connect="" Parent="countdown1" Color="#00ffff" Height="20" Y="0.3375" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="count_en" Inout="input" Width="20" Connect="" Parent="countdown1" Color="#8a2be2" Height="20" Y="0.5375" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.875" Name="tx_done" Inout="input" Width="20" Connect="" Parent="countdown1" Color="#d2691e" Height="20" Y="0.5375" Side="right" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.875" Name="count_full" Inout="output" Width="20" Connect="count_full" Parent="countdown1" Color="#a52a2a" Height="20" Y="0.3375" Side="right" Datatype="reg"/>
  <Port Datasize="8" Function="" X="0.875" Name="count_out" Inout="output" Width="20" Connect="count_out" Parent="countdown1" Color="#7fff00" Height="20" Y="0.1375" Side="right" Datatype="wire"/>
 </Module>
 <Module Code="&#x9;`define DEL 1&#xa;&#x9;&#xa;  //&#xa;&#x9;// Division is 78, which duty is 50% and frequency is 153846Hz&#xa;  // 153846 = 16 * 9600&#xa;&#x9;//&#xa;  reg [6:0] cnt;&#xa;&#xa;  always @( posedge clk or negedge rst_n ) begin&#xa;    if( ~rst_n ) begin&#xa;      cnt     &lt;= #`DEL 7'd0;&#xa;      clk_out &lt;= #`DEL 1'b0;&#xa;    end&#xa;    else if( cnt == 7'd38 ) begin&#xa;      cnt     &lt;= #`DEL cnt + 7'd1;&#xa;      clk_out &lt;= #`DEL 1'b1;&#xa;    end&#xa;    else if( cnt == 7'd77 ) begin&#xa;      cnt     &lt;= #`DEL 7'd0;&#xa;      clk_out &lt;= #`DEL 1'b0;&#xa;    end&#xa;    else begin&#xa;      cnt     &lt;= #`DEL cnt + 7'd1;&#xa;    end&#xa;  end  &#xa;" X="88.8535" Name="generate_clk1" Class="generate_clk" Parameters="" Width="71" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="92" Y="37.2944" File="Current/generate_clk.model" Type="model">
  <Port Datasize="1" Function="" X="-0.28169" Name="clk" Inout="input" Width="20" Connect="" Parent="generate_clk1" Color="#0000ff" Height="20" Y="0.141304" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.28169" Name="rst_n" Inout="input" Width="20" Connect="" Parent="generate_clk1" Color="#00ffff" Height="20" Y="0.391304" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="0.71831" Name="clk_out" Inout="output" Width="20" Connect="" Parent="generate_clk1" Color="#dc143c" Height="20" Y="0.217391" Side="right" Datatype="reg"/>
 </Module>
 <Module Code="`define DEL 1&#xa;&#xa;//&#xa;// Parity check&#xa;//&#xa;always @( posedge clk ) begin&#xa;  if( display_data_in[8] != ( ^display_data_in[7:0] ) ) begin&#xa;    $display(&quot;LED:Parity check failed!&quot;);&#xa;    $display(&quot;Receive data is: 9'b%b_%b_%b&quot;,display_data_in[8],display_data_in[7:4],display_data_in[3:0]);&#xa;    $finish;&#xa;  end&#xa;end  &#xa;&#xa;//&#xa;// LED display decoder&#xa;//&#xa;reg [6:0] seg [15:0];&#xa;initial begin&#xa;  seg[0] = 7'h3f; // 0&#xa;  seg[1] = 7'h06; // 1&#xa;  seg[2] = 7'h5b; // 2&#xa;  seg[3] = 7'h4f; // 3&#xa;  seg[4] = 7'h66; // 4&#xa;  seg[5] = 7'h6d; // 5&#xa;  seg[6] = 7'h7d; // 6&#xa;  seg[7] = 7'h07; // 7&#xa;  seg[8] = 7'h7f; // 8&#xa;  seg[9] = 7'h6f; // 9&#xa;  seg[10]= 7'h77; // A&#xa;  seg[11]= 7'h7c; // b&#xa;  seg[12]= 7'h39; // C&#xa;  seg[13]= 7'h5e; // d&#xa;  seg[14]= 7'h79; // E&#xa;  seg[15]= 7'h71; // F&#xa;end&#xa;&#xa;wire [3:0] led0_temp;&#xa;wire [3:0] led1_temp;&#xa;&#xa;assign led0_temp = display_data_in[3:0];&#xa;assign led1_temp = display_data_in[7:4];&#xa;&#xa;assign out_to_led0 = seg[led0_temp];&#xa;assign out_to_led1 = seg[led1_temp];&#xa;" X="977.1" Name="led_display1" Class="led_display" Parameters="" Width="160" Include="" Parent="uart_top" Comment="" Color="#d3d3d3" Height="160" Y="440.266" File="Current/led_display.model" Type="model">
  <Port Datasize="1" Function="" X="-0.125" Name="clk" Inout="input" Width="20" Connect="" Parent="led_display1" Color="#0000ff" Height="20" Y="0.2625" Side="left" Datatype="wire"/>
  <Port Datasize="1" Function="" X="-0.125" Name="rst_n" Inout="input" Width="20" Connect="" Parent="led_display1" Color="#00ffff" Height="20" Y="0.425" Side="left" Datatype="wire"/>
  <Port Datasize="9" Function="" X="-0.125" Name="display_data_in" Inout="input" Width="20" Connect="" Parent="led_display1" Color="#5f9ea0" Height="20" Y="0.5875" Side="left" Datatype="wire"/>
  <Port Datasize="9" Function="" X="0.875" Name="out_to_led1" Inout="output" Width="20" Connect="" Parent="led_display1" Color="#00bfff" Height="20" Y="0.4375" Side="right" Datatype="reg"/>
  <Port Datasize="9" Function="" X="0.875" Name="out_to_led0" Inout="output" Width="20" Connect="" Parent="led_display1" Color="#b8860b" Height="20" Y="0.1875" Side="right" Datatype="reg"/>
  <Port Datasize="1" Function="" X="-0.125" Name="display_en" Inout="input" Width="20" Connect="" Parent="led_display1" Color="#ffe4c4" Height="20" Y="0.1" Side="left" Datatype="wire"/>
 </Module>
 <Port Datasize="1" Function="" X="-0.0154679" Name="clk" Inout="input" Width="20" Parent="uart_top" Color="#0000ff" Height="20" Y="0.128453" Side="left" Datatype="wire"/>
 <Port Datasize="1" Function="" X="-0.0154679" Name="rst_n" Inout="input" Width="20" Parent="uart_top" Color="#00ffff" Height="20" Y="0.270718" Side="left" Datatype="wire"/>
 <Port Datasize="4" Function="" X="-0.0154679" Name="key_in" Inout="input" Width="20" Parent="uart_top" Color="#7fffd4" Height="20" Y="0.412983" Side="left" Datatype="wire"/>
 <Port Datasize="1" Function="" X="0.984532" Name="tx" Inout="output" Width="20" Parent="uart_top" Color="#bdb76b" Height="20" Y="0.270718" Side="right" Datatype="wire"/>
 <Port Datasize="1" Function="" X="-0.0154679" Name="count_enable" Inout="input" Width="20" Parent="uart_top" Color="#556b2f" Height="20" Y="0.697514" Side="left" Datatype="wire"/>
 <Port Datasize="1" Function="" X="0.984532" Name="tx_buf_full" Inout="output" Width="20" Parent="uart_top" Color="#ffe4c4" Height="20" Y="0.128453" Side="right" Datatype="wire"/>
 <Port Datasize="1" Function="" X="-0.0154679" Name="rx" Inout="input" Width="20" Parent="uart_top" Color="#b8860b" Height="20" Y="0.555249" Side="left" Datatype="wire"/>
 <Port Datasize="9" Function="" X="0.984532" Name="led0_out" Inout="output" Width="20" Parent="uart_top" Color="#1e90ff" Height="20" Y="0.697514" Side="right" Datatype="wire"/>
 <Port Datasize="9" Function="" X="0.984532" Name="led1_out" Inout="output" Width="20" Parent="uart_top" Color="#8b0000" Height="20" Y="0.555249" Side="right" Datatype="wire"/>
 <Port Datasize="1" Function="" X="0.984532" Name="clk_out" Inout="output" Width="20" Parent="uart_top" Color="#8a2be2" Height="20" Y="0.412983" Side="right" Datatype="wire"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#key1>rst_n"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#countdown1>rst_n"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#division_duty1>rst_n"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#uart1>rst_n"/>
 <Wire Datasize="4" From="uart_top>key_in" Name="uart_top_key_in" Parent="uart_top" Datatype="wire" To="uart_top#key1>key_in"/>
 <Wire Datasize="1" From="uart_top>rx" Name="uart_top_rx" Parent="uart_top" Datatype="wire" To="uart_top#uart1>rx"/>
 <Wire Datasize="1" From="uart_top>count_enable" Name="uart_top_count_enable" Parent="uart_top" Datatype="wire" To="uart_top#countdown1>count_en"/>
 <Wire Datasize="1" From="uart_top#countdown1>tx_done" Name="uart1_tx_buf_full" Parent="uart_top" Datatype="wire" To="uart_top#uart1>tx_buf_full"/>
 <Wire Datasize="1" From="uart_top#uart1>tx" Name="uart1_tx" Parent="uart_top" Datatype="wire" To="uart_top>tx"/>
 <Wire Datasize="9" From="uart_top#uart1>data_received" Name="uart1_data_received" Parent="uart_top" Datatype="wire" To="uart_top#division_duty1>data_in"/>
 <Wire Datasize="1" From="uart_top#uart1>rx_buf_full" Name="uart1_rx_buf_full" Parent="uart_top" Datatype="wire" To="uart_top#division_duty1>data_en"/>
 <Wire Datasize="1" From="uart_top#division_duty1>clk_out" Name="division_duty1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top>clk_out"/>
 <Wire Datasize="1" From="uart_top>clk" Name="uart_top_clk" Parent="uart_top" Datatype="wire" To="uart_top#generate_clk1>clk"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#generate_clk1>rst_n"/>
 <Wire Datasize="1" From="uart_top#generate_clk1>clk_out" Name="generate_clk1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top#uart1>clk"/>
 <Wire Datasize="1" From="uart_top#generate_clk1>clk_out" Name="generate_clk1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top#key1>clk"/>
 <Wire Datasize="1" From="uart_top#generate_clk1>clk_out" Name="generate_clk1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top#countdown1>clk"/>
 <Wire Datasize="1" From="uart_top#generate_clk1>clk_out" Name="generate_clk1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top#division_duty1>clk"/>
 <Wire Datasize="1" From="uart_top#generate_clk1>clk_out" Name="generate_clk1_clk_out" Parent="uart_top" Datatype="wire" To="uart_top#led_display1>clk"/>
 <Wire Datasize="1" From="uart_top>rst_n" Name="uart_top_rst_n" Parent="uart_top" Datatype="wire" To="uart_top#led_display1>rst_n"/>
 <Wire Datasize="9" From="uart_top#uart1>data_received" Name="uart1_data_received" Parent="uart_top" Datatype="wire" To="uart_top#led_display1>display_data_in"/>
 <Wire Datasize="1" From="uart_top#uart1>rx_buf_full" Name="uart1_rx_buf_full" Parent="uart_top" Datatype="wire" To="uart_top#led_display1>display_en"/>
 <Wire Datasize="9" From="uart_top#led_display1>out_to_led0" Name="led_display1_out_to_led0" Parent="uart_top" Datatype="wire" To="uart_top>led0_out"/>
 <Wire Datasize="9" From="uart_top#led_display1>out_to_led1" Name="led_display1_out_to_led1" Parent="uart_top" Datatype="wire" To="uart_top>led1_out"/>
 <Wire Datasize="1" From="uart_top#uart1>tx_buf_full" Name="uart1_tx_buf_full" Parent="uart_top" Datatype="wire" To="uart_top>tx_buf_full"/>
</Module>
